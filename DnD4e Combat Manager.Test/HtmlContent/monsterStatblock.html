<!DOCTYPE html>
<html>
<head>
    <title data-bind="text: Monster().Name"></title>
    <meta name="description" content="D&amp;D 4E Monster StatBlock display" />
    <meta name="author" content="Jason Fischer" />
    <script type='text/javascript' src='underscore.js'></script>
    <script type='text/javascript' src='jquery-1.10.2.js'></script>
    <script type='text/javascript' src='knockout-3.0.0.debug.js'></script>
    <script type='text/javascript' src='knockout-StringInterpolatingBindingProvider.js'></script>
    <script type='text/javascript' src='bindingHandlers.js'></script>
    <script type='text/javascript' src='monsterStatblock.js'></script>
</head>
<body>
    <div id="detail">
        <h1 class="monster" data-bind="text: Monster().Name"></h1>
        <span class="type" data-bind="text: TraitsString()"></span>
        <span class="level" data-bind="text: LevelString()"></span>
        <span class="xp" data-bind="commaNum: Monster().Experience, prefix: 'XP '"></span>
        <table class="bodytable">
            <tr>
                <td><b>HP</b>&nbsp;<span data-bind="commaNum: Monster().HitPoints"></span>;&nbsp;<b>Bloodied</b>&nbsp;<span data-bind="commaNum: Bloodied()"></span></td>
                <td class="rightalign"><b>Initiative</b>&nbsp;<span data-bind="commaNum: Monster().Initiative, signed: true"></span></td>
            </tr>
            <tr>
                <td>
                    <b>AC</b>&nbsp;<span data-bind="text: Monster().Defenses.AC"></span>,&nbsp;
                    <b>Fortitude</b>&nbsp;<span data-bind="text: Monster().Defenses.Fortitude"></span>,&nbsp;
                    <b>Reflex</b>&nbsp;<span data-bind="text: Monster().Defenses.Reflex"></span>,&nbsp;
                    <b>Will</b>&nbsp;<span data-bind="text: Monster().Defenses.Will"></span>
                </td>
                <td class="rightalign">
                    <!-- ko if: Monster().Skills.Perception --><b>Perception</b>&nbsp;<span data-bind="commaNum: Monster().Skills.Perception, signed: true"></span><!-- /ko -->
                </td>
            </tr>
            <tr>
                <td><b>Speed</b>&nbsp;<span data-bind="text: Monster().Speed"></span><!-- ko if: _.size(Monster().OtherSpeeds) -->,&nbsp;<span data-bind="stringArray: Monster().OtherSpeeds"></span><!-- /ko --><!-- ko if: Monster().Phasing -->; phasing<!-- /ko --></td>
                <td class="rightalign"><span data-bind="kvpArray: Monster().Senses"></span></td>
            </tr>
            <tr>
                <td colspan="2">
                    <!-- ko if: _.size(Monster().Immunities)--><b>Immune</b>&nbsp;<span data-bind="stringArray: Monster().Immunities"></span><!-- /ko -->
                    <!-- ko if: _.size(Monster().Resistances)--><b>Resist</b>&nbsp;<span data-bind="stringArray: Monster().Resistances"></span><!-- /ko -->
                    <!-- ko if: _.size(Monster().Weaknesses)--><b>Vulnerability</b>&nbsp;<span data-bind="stringArray: Monster().Weaknesses"></span><!-- /ko -->
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <b>Saving Throws</b>&nbsp;<span data-bind="commaNum: Monster().SavingThrows, signed: true"></span>;&nbsp;
                    <b>Action Points</b>&nbsp;<span data-bind="text: Monster().ActionPoints"></span>
                </td>
            </tr>
        </table>
        
        <!-- ko if: _.size(Monster().Traits) -->
            <h2>Traits</h2>
            <div data-bind="template: { name: 'trait', foreach: Monster().Traits }"></div>
        <!-- /ko -->
        
        <!-- ko if: _.findWhere(Monster().Powers, { Action: 'Standard' }) -->
            <h2>Standard Actions</h2>
            <div data-bind="template: { name: 'power', foreach: _.where(Monster().Powers, { Action: 'Standard' }), as: 'power' }"></div>
        <!-- /ko -->

        <!-- ko if: _.findWhere(Monster().Powers, { Action: 'Move' }) -->
            <h2>Move Actions</h2>
            <div data-bind="template: { name: 'power', foreach: _.where(Monster().Powers, { Action: 'Move' }), as: 'power' }"></div>
        <!-- /ko -->

        <!-- ko if: _.findWhere(Monster().Powers, { Action: 'Minor' }) -->
            <h2>Minor Actions</h2>
            <div data-bind="template: { name: 'power', foreach: _.where(Monster().Powers, { Action: 'Minor' }), as: 'power' }"></div>
        <!-- /ko -->

        <!-- ko if: _.find(Monster().Powers, function(power) { return !_.isEmpty(power.Trigger) }) -->
            <h2>Triggered Actions</h2>
            <div data-bind="template: { name: 'power', foreach: _.filter(Monster().Powers, function(power) { return !_.isEmpty(power.Trigger) }), as: 'power' }"></div>
        <!-- /ko -->
        
        <!--
        <h2>Standard Actions</h2>
        <p class="flavor alt">
            <img src="http://www.wizards.com/dnd/images/symbol/S2.gif" />
            <b>Bite</b>
            <img src="http://www.wizards.com/dnd/images/symbol/x.gif" />
            <b>At-Will</b>
        </p>
        <p class="flavorIndent">
            <i>Attack:</i> Melee 1 (one creature); +21 vs. Reflex
           
        </p>
        <p class="flavorIndent">
            <i>Hit:</i> 3d8 + 13 necrotic damage.
           
        </p>
        <p class="flavor alt">
            <img src="http://www.wizards.com/dnd/images/symbol/Z3a.gif" />
            <b>Eye Ray</b>
            <img src="http://www.wizards.com/dnd/images/symbol/x.gif" />
            <b>At-Will</b>
        </p>
        <p class="flavorIndent">
            <i>Effect:</i> The beholder uses one of the following eye rays without provoking an opportunity attack.
           
        </p>
        <p class="flavorIndent">
            <b>1. Chill of the Grave</b> (cold, necrotic) <b></b>
        </p>
        <p class="flavorIndent">
            <i>Attack:</i>  Ranged 10 (one creature); +21 vs. Fortitude
           
        </p>
        <p class="flavorIndent">
            <i>Hit:</i> 4d8 + 8 cold and necrotic damage, and the target is slowed (save ends).
           
        </p>
        <p class="flavorIndent">
            &nbsp;&nbsp;&nbsp;&nbsp;<i>First Failed Saving Throw:</i> The target is immobilized instead of slowed (save ends).
           
        </p>
        <p class="flavorIndent">
            <b>2. Ghostly Possession</b> (psychic) <b></b>
        </p>
        <p class="flavorIndent">
            <i>Attack:</i>  Ranged 10 (one creature); +21 vs. Will
           
        </p>
        <p class="flavorIndent">
            <i>Hit:</i> Ongoing 15 psychic damage (save ends).
           
        </p>
        <p class="flavorIndent">
            &nbsp;&nbsp;&nbsp;&nbsp;<i>First Failed Saving Throw:</i> In addition to the ongoing damage, the target is dazed (save ends both).
           
        </p>
        <p class="flavorIndent">
            &nbsp;&nbsp;&nbsp;&nbsp;<i>Second Failed Saving Throw:</i> The target is dominated instead of dazed and continues to take the ongoing damage (save ends both). The beholder is removed from play until the effect ends. When the effect ends, the beholder reappears in an unoccupied space within 10 squares of the target. The beholder can end the effect as a free action.
           
        </p>
        <p class="flavorIndent">
            <b>3. Killing Thought</b> (psychic) <b></b>
        </p>
        <p class="flavorIndent">
            <i>Attack:</i>  Ranged 10 (one creature); +21 vs. Will
           
        </p>
        <p class="flavorIndent">
            <i>Hit:</i> 1d8 + 9 psychic damage, and the target makes a melee basic attack against itself as a free action. If the target is not wielding a melee weapon, it drops a held item and draws a melee weapon as a free action and then makes the attack.
           
        </p>
        <h2>Minor Actions</h2>
        <p class="flavor alt">
            <img src="http://www.wizards.com/dnd/images/symbol/S3.gif" />
            <b>Central Eye</b> (fear)
            <img src="http://www.wizards.com/dnd/images/symbol/x.gif" />
            <b>At-Will</b> 1/round
           
        </p>
        <p class="flavorIndent">
            <i>Attack:</i> Ranged 10 (one creature); +21 vs. Will
           
        </p>
        <p class="flavorIndent">
            <i>Hit:</i> The beholder slides the target 5 squares, and the target gains vulnerable 5 necrotic and vulnerable 5 psychic until the start of the beholderâ€™s next turn.
           
        </p>
        <h2>Triggered Actions</h2>
        <p class="flavor alt">
            <img src="http://www.wizards.com/dnd/images/symbol/Z3a.gif" />
            <b>Eyes of the Beholder</b>
            <img src="http://www.wizards.com/dnd/images/symbol/x.gif" />
            <b>At-Will</b>
        </p>
        <p class="flavorIndent">
            <i>Trigger:</i> An enemy starts its turn within 5 squares of the beholder.
           
        </p>
        <p class="flavorIndent">
            <i>Effect (Free Action):</i> The beholder uses eye ray against the triggering enemy. Determine which ray it uses by rolling a d4, rerolling the die on a result of 4.           
        </p>
        -->
        
		<table class="flavor alt">
			<tr>
				<td class="indmed">
					<b>Str</b>&nbsp;<span data-bind="abilityScore: Monster().AbilityScores.Strength"></span>
				</td>
				<td class="indmed">
					<b>Dex</b>&nbsp;<span data-bind="abilityScore: Monster().AbilityScores.Dexterity"></span>
				</td>
				<td class="indmed">
					<b>Wis</b>&nbsp;<span data-bind="abilityScore: Monster().AbilityScores.Wisdom"></span>
				</td>
			</tr>
			<tr>
				<td class="indmed">
					<b>Con</b>&nbsp;<span data-bind="abilityScore: Monster().AbilityScores.Constitution"></span>
				</td>
				<td class="indmed">
					<b>Int</b>&nbsp;<span data-bind="abilityScore: Monster().AbilityScores.Intelligence"></span>
				</td>
				<td class="indmed">
					<b>Cha</b>&nbsp;<span data-bind="abilityScore: Monster().AbilityScores.Charisma"></span>
				</td>
			</tr>
		</table>
        <p class="flavor alt">
            <b>Alignment</b>&nbsp;<span data-bind="text: Monster().Alignment"></span>
			<b>Languages</b>&nbsp;<span data-bind="stringArray: Monster().Languages, fallback: '-'"></span><br/>
            <!-- ko if _.omit(Monster().Skills, 'Perception') --><b>Skills</b>&nbsp;<span data-bind="template: { name: 'skills', data: { name: 'Skills', data: _.omit(Monster().Skills, 'Perception') } }"></span><br/><!-- /ko -->
            <!-- ko if: _.size(Monster().Items) --><b>Equipment</b>&nbsp;<span data-bind="kvpArray: Monster().Items, min: 2, valuePrefix: ' x '"></span><br /><!-- /ko -->
            <b>Source</b>&nbsp;<a data-bind="attr: { href: Monster().CompendiumUrl }">{{ Monster().SourceBook }}</a><br/>               
        </p>
    </div>
<script type="text/html" id="skills">
    <!-- ko foreach: _.pairs(data) -->
        <span data-bind="text: $data[0]"></span>
        <span data-bind="commaNum: $data[1], signed: true"></span><!-- ko if: $index()+1 < _.size($parent.data) -->, <!-- /ko -->
    <!-- /ko -->
</script>
<script type="text/html" id="attackBonuses">
<!-- ko foreach: _.pairs($data) -->{{($data[1] > 0 ? '+' : '') + $data[1]}} vs. {{$data[0]}}<!-- ko if: $index()+1 < _.size($parent.data) -->, <!-- /ko --><!-- /ko -->
</script>
<script type="text/html" id="power">
    <p class="flavor alt">
        <font face="4etools symbols" data-bind="powerFont: power"></font>
        <b data-bind="text: Name"></b><span data-bind="if: _.size(Keywords)">&nbsp;({{ Keywords.join(', ') }}) </span>
        <b data-bind="text: '&bull; ' + Usage"></b>&nbsp;<font face="4etools symbols" data-bind="rechargeFont: power"></font>
    </p>
    <p class="flavorIndent" data-bind="if: Trigger"><i>Trigger:</i> {{Trigger}}</p>
    <!-- ko foreach: Attacks -->
        <p class="flavorIndent" data-bind="if: !Hit.IsEmpty">
            <i>Attack<!-- ko if: $parent.Action === 'Immediate Interrupt' || $parent.Action === 'Immediate Reaction' --> ({{$parent.Action}})<!-- /ko -->: </i>
            <span data-bind="if: Range">{{Range}}</span>
            <!-- ko if: Targets -->&nbsp;({{Targets}})<!-- /ko --><!-- ko if: Range || Targets-->;<!-- /ko -->
            <span data-bind="template: { name: 'attackBonuses', data: AttackBonuses }"></span>
        </p>
        <p class="flavorIndent" data-bind="if: !Hit.IsEmpty">
            <i>Hit: </i>
            <span data-bind="if: Hit.Damage">{{Hit.Damage}} </span>
            <span data-bind="text: Hit.Description"></span>
            <p data-bind="foreach: Hit.AfterEffects, as: 'aftereffect'">&nbsp;&nbsp;&nbsp;&nbsp;<i>Aftereffect: </i>{{Description}}</p>
        </p>
        <p class="flavorIndent" data-bind="if: !Miss.IsEmpty">
            <i>Miss: </i>
            <span data-bind="if: Miss.Damage">{{Miss.Damage}} </span>
            <span data-bind="text: Miss.Description"></span>
        </p>
        <p class="flavorIndent" data-bind="if: !Effect.IsEmpty">
            <i>Effect<!-- ko if: $parent.Action !== 'Standard' --> ({{$parent.Action}})<!-- /ko -->: </i>
            <span data-bind="text: Effect.Description"></span>
            <p data-bind="foreach: Effect.Sustains, as: 'sustain'">&nbsp;&nbsp;&nbsp;&nbsp;<i>Sustain {{Action}}: </i>{{Description}}</p>
        </p>
    <!-- /ko -->
</script>
<script type="text/html" id="trait">
    <p class="flavor alt">
        <!-- TODO: go about finding an aura icon / font -->
        <b data-bind="text: Name"></b><span data-bind="if: _.size(Keywords)"> ({{ Keywords.join(', ') }}) </span>
        <!-- ko if: Range --><b>&bull; Aura </b><span data-bind="text: Range"></span><!-- /ko -->
    </p>
    <p class="flavorIndent" data-bind="text: Details"></p>
</script>
</body>
</html>

