// http://jsfiddle.net/7P8Tp/

// adept of orcus
//var debugJson = '{"CompendiumUrl":"http://www.wizards.com/dndinsider/compendium/monster.aspx?id=4887","Description":"In the dark shrine, they spoke in whispers of the fallen priest who had died with a prayer to Orcus on his lips. He might have remained dead, his soul to become a plaything of Orcus, except that he had killed and consumed a priest of Bahamut when he was alive. After his death, he underwent a horrid and unholy transformation. Now, as he rises again, the priest’s gruesome form strikes terror even into the hearts of his former faithful.","GroupRole":"Standard","IsLeader":true,"Items":[{"Key":"holy symbol of Orcus","Value":1},{"Key":"Rod Implement","Value":1}],"Keywords":["Undead"],"Immunities":["Disease","Poison"],"Origin":"Natural","OtherSpeeds":[],"Phasing":false,"Powers":[{"Action":"Standard","Attacks":[{"AttackBonuses":{"AC":11},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"2d6 + 4","Description":"damage, and the target is immobilized (save ends).","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Range":"Melee 1","Targets":"one creature"}],"Flavor":null,"IsBasic":true,"Keywords":[],"Name":"Claw","Requirements":null,"Trigger":null,"Type":"Melee","Usage":"At-Will","UsageDetails":null},{"Action":"Standard","Attacks":[{"AttackBonuses":{"Reflex":9},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The target is restrained (save ends).","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Range":"Ranged 5","Targets":"one creature"}],"Flavor":null,"IsBasic":false,"Keywords":["Implement"],"Name":"Grave Grasp","Requirements":null,"Trigger":null,"Type":"Ranged","Usage":"At-Will","UsageDetails":null},{"Action":"Standard","Attacks":[{"AttackBonuses":{"Will":9},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The target is immobilized (save ends). One of the adept’s allies that is adjacent to the target can make a melee basic attack against the target as a free action.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Range":"Ranged 5","Targets":"one creature"}],"Flavor":null,"IsBasic":false,"Keywords":["Implement"],"Name":"Call to Feast","Requirements":null,"Trigger":null,"Type":"Ranged","Usage":"Recharge","UsageDetails":"5"},{"Action":"Standard","Attacks":[{"AttackBonuses":{"Fortitude":9},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The burst creates a zone that lasts until the end of the encounter. Any living creature that enters the zone or ends its turn there takes 5 necrotic damage.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"2d6 + 7","Description":"necrotic damage.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Range":"Area burst 1 within 5","Targets":"living creatures in the burst"}],"Flavor":null,"IsBasic":false,"Keywords":["Implement","necrotic","zone"],"Name":"Grave Dust Cloud","Requirements":null,"Trigger":null,"Type":"Area","Usage":"Encounter","UsageDetails":null}],"Regeneration":0,"Resistances":["10 Necrotic"],"Role":"Controller","SavingThrows":0,"Senses":[{"Key":"Darkvision","Value":0}],"SourceBook":"Monster Manual 3","SourceBooks":null,"Tactics":"An adept chants the Litanies of Flesh Devoured—a series of oaths dedicated to Orcus—while it attempts to prepare the enemy’s flesh for consumption. As the adept’s raspy voice echoes across the battlefield, it paralyzes enemies to allow its undead allies to mob them.","Traits":[{"Name":"Uneasy Grave","Details":"Any nonminion ghoul ally within the aura that drops to 0 hit points becomes a zombie rotter at the start of its next turn.","Keywords":[],"Range":5}],"Type":"Humanoid","Weaknesses":["5 Radiant"],"AbilityScores":{"Strength":14,"Constitution":15,"Dexterity":19,"Intelligence":12,"Wisdom":14,"Charisma":17},"ActionPoints":0,"Alignment":"ChaoticEvil","Defenses":{"AC":20,"Fortitude":16,"Reflex":19,"Will":18},"Experience":250,"Handle":"Adept of Orcus (Co6S)","HitPoints":71,"Initiative":7,"Speed":8,"Languages":["Abyssal","Common"],"Level":6,"Name":"Adept of Orcus","Race":null,"Skills":{"Perception":5,"Religion":9,"Stealth":12},"Size":"Medium"}';

// beholder
//var debugJson = '{"CompendiumUrl":"http://www.wizards.com/dndinsider/compendium/monster.aspx?id=5559","Description":"","GroupRole":"Solo","IsLeader":false,"Items":[],"Keywords":[],"Immunities":[],"Origin":"Aberrant","OtherSpeeds":["Fly 4 (hover)"],"Phasing":false,"Powers":[{"Action":"Standard","Attacks":[{"AttackBonuses":{"AC":14},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"2d8 + 8","Description":"damage.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Attack","Range":"Melee 1","Targets":"one creature"}],"Flavor":null,"IsBasic":true,"Keywords":[],"Name":"Bite","Requirements":null,"Trigger":null,"Type":"Melee","Usage":"At-Will","UsageDetails":null},{"Action":"Standard","Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Ranged 10; +14 vs. Will; the target is dominated until the end of its next turn.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"1. Charm Ray (charm)","Range":"","Targets":null},{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Ranged 10; +14 vs. Fortitude; 2d10 + 6 necrotic damage.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"2. Wounding Ray (necrotic)","Range":"","Targets":null},{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Ranged 10; +14 vs. Will; the target is immobilized (save ends).","FailedSavingThrows":[{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The target is knocked unconscious instead of immobilized (save ends).","FailedSavingThrows":[],"IsEmpty":false,"Name":null,"Sustains":[]}],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"3. Sleep Ray (charm)","Range":"","Targets":null},{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Ranged 10; +14 vs. Fortitude; the beholder slides the target up to 4 squares.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"4. Telekinesis Ray","Range":"","Targets":null},{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Ranged 10; +14 vs. Reflex; 3d6 + 5 necrotic damage, and the target is slowed (save ends).","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"5. Slowing Ray (necrotic)","Range":"","Targets":null},{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Ranged 10; +14 vs. Will; 1d6 + 5 radiant damage, and the target is blinded (save ends).","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"6. Brilliant Ray (radiant)","Range":"","Targets":null},{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Ranged 10; +14 vs. Will; 2d8 + 5 psychic damage, and the beholder pushes the target its speed.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"7. Terror Ray (fear, psychic)","Range":"","Targets":null},{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The target is immobilized (save ends).","FailedSavingThrows":[],"IsEmpty":false,"Name":"Aftereffect","Sustains":[]}],"Attacks":[],"Damage":"","Description":"Ranged 10; +14 vs. Fortitude; the target is petrified (save ends).","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"8. Petrifying Ray","Range":"","Targets":null},{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Ranged 10; +14 vs. Fortitude; 2d8 + 10 necrotic damage. If the target is bloodied before or after the attack, it is also dazed (save ends).","FailedSavingThrows":[{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The target is dazed and weakened (save ends both).","FailedSavingThrows":[],"IsEmpty":false,"Name":null,"Sustains":[]},{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The target dies.","FailedSavingThrows":[],"IsEmpty":false,"Name":null,"Sustains":[]}],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"9. Death Ray (necrotic)","Range":"","Targets":null},{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Ranged 10; +14 vs. Fortitude; 1d8 + 5 damage, and ongoing 10 damage (save ends).","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"10. Disintegrate Ray","Range":"","Targets":null}],"Damage":"","Description":"The beholder uses two of the following eye rays, using each against a different target. This attack does not provoke opportunity attacks.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Effect","Range":"","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":[],"Name":"Eye Rays","Requirements":null,"Trigger":null,"Type":"Ranged","Usage":"At-Will","UsageDetails":null},{"Action":"Standard","Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"As eye rays above, except the beholder makes three eye ray attacks.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Effect","Range":"","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":[],"Name":"Eye Ray Frenzy","Requirements":"The beholder must be bloodied","Trigger":null,"Type":"Ranged","Usage":"Recharge","UsageDetails":"6"},{"Action":"Minor","Attacks":[{"AttackBonuses":{"Will":12},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The target cannot use encounter or daily attack powers until the end of its next turn.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Attack","Range":"Close blast 5","Targets":"enemies in the blast"}],"Flavor":null,"IsBasic":false,"Keywords":[],"Name":"Central Eye","Requirements":null,"Trigger":null,"Type":"Close Blast","Usage":"At-Will","UsageDetails":"(1/round)"},{"Action":"No Action","Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The beholder uses one random eye ray against the triggering enemy.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Effect","Range":"","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":[],"Name":"Random Eye Ray","Requirements":null,"Trigger":"The beholder is conscious and an enemy starts its turn within 5 squares of it.","Type":"Ranged","Usage":"At-Will","UsageDetails":null}],"Regeneration":0,"Resistances":[],"Role":"Artillery","SavingThrows":5,"Senses":[{"Key":"all-around vision","Value":0},{"Key":"Darkvision","Value":0}],"SourceBook":"Monster Vault","SourceBooks":null,"Tactics":"","Traits":[{"Name":"All-Around Vision","Details":"Enemies can’t gain combat advantage by flanking the beholder.","Keywords":[],"Range":0}],"Type":"Magical Beast","Weaknesses":[],"AbilityScores":{"Strength":18,"Constitution":18,"Dexterity":20,"Intelligence":19,"Wisdom":15,"Charisma":20},"ActionPoints":2,"Alignment":"Evil","Defenses":{"AC":23,"Fortitude":21,"Reflex":22,"Will":22},"Experience":2000,"Handle":"Beholder (Ar9S)","HitPoints":392,"Initiative":9,"Speed":0,"Languages":["Deep Speech"],"Level":9,"Name":"Beholder","Race":null,"Skills":{"Perception":11},"Size":"Large"}';

// beholder eternal tyrant shell
//var debugJson = '{"CompendiumUrl":"http://www.wizards.com/dndinsider/compendium/monster.aspx?id=3609","Description":"","GroupRole":"Elite","IsLeader":false,"Items":[],"Keywords":["Construct"],"Immunities":["Disease","Poison"],"Origin":null,"OtherSpeeds":["Fly 8 (hover)"],"Phasing":false,"Powers":[{"Action":"Standard","Attacks":[{"AttackBonuses":{"AC":34},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"","FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"4d8 + 12","Description":"damage","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":null,"Range":"","Targets":null}],"Flavor":null,"IsBasic":true,"Keywords":[],"Name":"Bite","Requirements":null,"Trigger":null,"Type":"Melee","Usage":"At-Will","UsageDetails":null},{"Action":"Free","Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The beholder eternal tyrant shell makes a bite attack against the triggering enemy; ","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":null,"Range":"","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":[],"Name":"Jaws of the Beholder","Requirements":null,"Trigger":"when an adjacent enemy is hit by any beholder’s eye ray","Type":"Melee","Usage":"At-Will","UsageDetails":null},{"Action":"Standard","Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Ongoing 10 damage (save ends). ###2—Telekinetic Slam Ray (Force): Ranged 10; +32 vs. Fortitude; 2d10 + 10 force damage, the beholder slides the target 10 squares, and the target is knocked prone. ###3—Fire Ray (Fire): Ranged 10; +32 vs. Reflex; 4d8 + 14 fire damage. ###4—Acid Ray (Acid): Ranged 10; +32 vs. Reflex; 2d6 + 10 acid damage, and ongoing 15 acid damage (save ends). ###5—Thunderbolt Ray (Lightning, Thunder): Ranged 10; +32 vs. Reflex; 4d6 + 10 lightning damage, and each creature within 2 squares of the target takes 10 thunder damage;","FailedSavingThrows":[],"IsEmpty":false,"Name":"Aftereffect","Sustains":[]}],"Attacks":[],"Damage":"","Description":"The beholder eternal tyrant shell uses one eye ray power chosen from the list below. Using eye ray does not provoke opportunity attacks. ###1—Disintegrate Ray: Ranged 10; +32 vs. Fortitude; 1d10 + 8 damage, and the target takes ongoing 15 damage (save ends).","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":null,"Range":"","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":[],"Name":"Eye Rays","Requirements":null,"Trigger":null,"Type":"Ranged","Usage":"At-Will","UsageDetails":null},{"Action":"Minor 1/Round","Attacks":[{"AttackBonuses":{"Will":32},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"","FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"until the end of the beholder eternal tyrant shell’s next turn, the target is marked and takes half damage when missed by an eye ray attack","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":null,"Range":"Close blast 5","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":["Charm"],"Name":"Central Eye","Requirements":null,"Trigger":null,"Type":"Close","Usage":"At-Will","UsageDetails":null}],"Regeneration":0,"Resistances":[],"Role":"Brute","SavingThrows":2,"Senses":[{"Key":"all-around vision","Value":0},{"Key":"Darkvision","Value":0}],"SourceBook":"Dragon Magazine 377","SourceBooks":null,"Tactics":"","Traits":[],"Type":"Magical Beast","Weaknesses":[],"AbilityScores":{"Strength":38,"Constitution":40,"Dexterity":30,"Intelligence":7,"Wisdom":26,"Charisma":36},"ActionPoints":1,"Alignment":"Evil","Defenses":{"AC":43,"Fortitude":45,"Reflex":43,"Will":41},"Experience":46000,"Handle":"Beholder Eternal Tyrant Shell (Br31E)","HitPoints":720,"Initiative":25,"Speed":0,"Languages":["Deep Speech"],"Level":31,"Name":"Beholder Eternal Tyrant Shell","Race":null,"Skills":{"Perception":28},"Size":"Huge"}';

// catoblepas tragedian
//var debugJson = '{"CompendiumUrl":"http://www.wizards.com/dndinsider/compendium/monster.aspx?id=4786","Description":"At the world’s end, a river of souls flows into the Shadowfell through a jungle poisoned by the corruption of tainted souls. Along the river’s bank, a catoblepas tragedian grazes beneath the full moon, growing enormous before it passes through the veil to the Raven Queen’s realm. A tragedian’s bowed, hidden face is formed in the shape of a humanoid tragedian’s mask, an agonized accumulation of the strife it has witnessed.","GroupRole":"Elite","IsLeader":false,"Items":[],"Keywords":[],"Immunities":[],"Origin":"Shadow","OtherSpeeds":[],"Phasing":false,"Powers":[{"Action":"Standard","Attacks":[{"AttackBonuses":{"AC":23},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"3d8 + 13","Description":"damage.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Attack","Range":"Melee 1","Targets":"one creature"}],"Flavor":null,"IsBasic":true,"Keywords":[],"Name":"Gore","Requirements":null,"Trigger":null,"Type":"Melee","Usage":"At-Will","UsageDetails":null},{"Action":"Standard","Attacks":[{"AttackBonuses":{"Fortitude":21},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"2d6 + 9","Description":"poison damage, and ongoing 10 poison damage (save ends).","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Attack","Range":"Close blast 5","Targets":"creatures in the blast"}],"Flavor":null,"IsBasic":false,"Keywords":["Poison"],"Name":"Poison Breath","Requirements":null,"Trigger":null,"Type":"Close Blast","Usage":"Recharge","UsageDetails":"5"},{"Action":"Standard","Attacks":[{"AttackBonuses":{"Will":21},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"1d8 + 9","Description":"necrotic damage, and the target is weakened (save ends).","FailedSavingThrows":[{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The target is weakened and blinded (save ends both).","FailedSavingThrows":[],"IsEmpty":false,"Name":null,"Sustains":[]},{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The target’s hit points drop to -1.","FailedSavingThrows":[],"IsEmpty":false,"Name":null,"Sustains":[]}],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Attack","Range":"Close burst 10","Targets":"one bloodied creature in the burst"}],"Flavor":null,"IsBasic":false,"Keywords":[],"Name":"Withering Gaze","Requirements":null,"Trigger":null,"Type":"Close Burst","Usage":"Recharge","UsageDetails":"when no enemy is affected by this power"},{"Action":"Minor","Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"Choose one enemy within 20 squares. The tragedian pulls that enemy 3 squares.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Effect","Range":"","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":["Charm"],"Name":"Inevitable Call","Requirements":null,"Trigger":null,"Type":"Close Burst","Usage":"At-Will","UsageDetails":null},{"Action":"Opportunity Action","Attacks":[{"AttackBonuses":{"Will":21},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"20","Description":"necrotic damage.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Aftereffect","Sustains":[]}],"Attacks":[],"Damage":"10","Description":"necrotic damage, and the target is immobilized and gains vulnerable 5 to all damage (save ends both).","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Attack","Range":"Close burst 10","Targets":"the triggering enemy in the burst"}],"Flavor":null,"IsBasic":false,"Keywords":["Charm","necrotic"],"Name":"Final Glance","Requirements":null,"Trigger":"An enemy within 5 squares of the tragedian willingly moves away from it.","Type":"Close Burst","Usage":"At-Will","UsageDetails":null}],"Regeneration":0,"Resistances":["10 Necrotic"],"Role":"Controller","SavingThrows":2,"Senses":[{"Key":"blindsight","Value":5}],"SourceBook":"Monster Manual 3","SourceBooks":null,"Tactics":"A catoblepas tragedian’s deep humming works like a siren’s song, calling living creatures to their dooms. A tragedian’s victims walk forward and rest their heads against its shaggy flank. The victims who inhale a tragedian’s deadly breath or look upon its visage wither into husks.","Traits":[{"Name":"Raven Queen’s Presence","Details":"Any creature within the aura that fails a death saving throw takes damage equal to half its bloodied value.","Keywords":[],"Range":5}],"Type":"Beast","Weaknesses":[],"AbilityScores":{"Strength":24,"Constitution":28,"Dexterity":22,"Intelligence":3,"Wisdom":23,"Charisma":25},"ActionPoints":1,"Alignment":"Unaligned","Defenses":{"AC":32,"Fortitude":30,"Reflex":28,"Will":30},"Experience":4000,"Handle":"Catoblepas Tragedian (Co18E)","HitPoints":360,"Initiative":15,"Speed":6,"Languages":[],"Level":18,"Name":"Catoblepas Tragedian","Race":null,"Skills":{"Perception":15},"Size":"Huge"}';

// kobold cleaver
//var debugJson = '{"CompendiumUrl":"http://www.wizards.com/dndinsider/compendium/monster.aspx?id=2238","Description":"","GroupRole":"Minion","IsLeader":false,"Items":[{"Key":"Leather Armor","Value":1},{"Key":"Short sword","Value":2}],"Keywords":["Reptile"],"Immunities":[],"Origin":"Natural","OtherSpeeds":[],"Phasing":false,"Powers":[{"Action":"Standard","Attacks":[{"AttackBonuses":{"AC":6},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"","FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"5","Description":"damage","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":null,"Range":"","Targets":null}],"Flavor":null,"IsBasic":true,"Keywords":["Weapon"],"Name":"Short Sword","Requirements":null,"Trigger":null,"Type":"Melee","Usage":"At-Will","UsageDetails":null},{"Action":"Minor","Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The kobold shifts 1 square.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"5","Description":null,"FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":null,"Range":"","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":[],"Name":"Shifty","Requirements":null,"Trigger":null,"Type":"","Usage":"At-Will","UsageDetails":null}],"Regeneration":0,"Resistances":[],"Role":"No Role","SavingThrows":0,"Senses":[{"Key":"Darkvision","Value":0}],"SourceBook":"Dungeon Delve","SourceBooks":null,"Tactics":"","Traits":[{"Name":"Spinning Slash","Details":"If a kobold cleaver hits with a short sword attack, it deals 2 damage to one other enemy adjacent to it.","Keywords":[],"Range":0},{"Name":"Trap Sense","Details":"A kobold cleaver gains a +2 bonus to all defenses against traps.","Keywords":[],"Range":0}],"Type":"Humanoid","Weaknesses":[],"AbilityScores":{"Strength":8,"Constitution":14,"Dexterity":16,"Intelligence":9,"Wisdom":10,"Charisma":10},"ActionPoints":0,"Alignment":"Evil","Defenses":{"AC":16,"Fortitude":14,"Reflex":14,"Will":11},"Experience":31,"Handle":"Kobold Cleaver (No2M)","HitPoints":1,"Initiative":4,"Speed":6,"Languages":["Common","Draconic"],"Level":2,"Name":"Kobold Cleaver","Race":null,"Skills":{"Perception":1,"Stealth":6,"Thievery":6},"Size":"Small"}';

// king's dark lantern
var debugJson = '{"CompendiumUrl":"http://www.wizards.com/dndinsider/compendium/monster.aspx?id=3239","Description":"","GroupRole":"Elite","IsLeader":false,"Items":[{"Key":"cloak","Value":1},{"Key":"Leather Armor","Value":1},{"Key":"Bastard sword","Value":1},{"Key":"Longbow","Value":1},{"Key":"Arrow","Value":15}],"Keywords":[],"Immunities":[],"Origin":"Natural","OtherSpeeds":[],"Phasing":false,"Powers":[{"Action":"Standard","Attacks":[{"AttackBonuses":{"AC":13},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"1d10 + 11","Description":"damage.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Attack","Range":"Melee 1","Targets":"one creature"}],"Flavor":null,"IsBasic":true,"Keywords":["Weapon"],"Name":"Bastard Sword","Requirements":null,"Trigger":null,"Type":"Melee","Usage":"At-Will","UsageDetails":null},{"Action":"Standard","Attacks":[{"AttackBonuses":{"AC":13},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"1d10 + 11","Description":"damage.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Attack","Range":"Ranged 20","Targets":"one creature"}],"Flavor":null,"IsBasic":true,"Keywords":["Weapon"],"Name":"Longbow","Requirements":null,"Trigger":null,"Type":"Ranged","Usage":"At-Will","UsageDetails":null},{"Action":"Standard","Attacks":[{"AttackBonuses":{"AC":13},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"1d10 + 11","Description":"damage, and the Dark Lantern shifts 2 squares and has total concealment against the target until the end of the Dark Lantern’s next turn.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Attack","Range":"Melee 1","Targets":"one creature"}],"Flavor":null,"IsBasic":false,"Keywords":["Weapon"],"Name":"Blinding Strike","Requirements":null,"Trigger":null,"Type":"Melee","Usage":"At-Will","UsageDetails":null},{"Action":"Standard","Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The Dark Lantern uses bastard sword twice, longbow twice, or blinding strike twice.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Effect","Range":"","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":[],"Name":"Double Attack","Requirements":null,"Trigger":null,"Type":"Melee###Ranged","Usage":"At-Will","UsageDetails":null},{"Action":"Minor","Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The Dark Lantern turns invisible until it attacks or until the end of its next turn.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Effect","Range":"","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":["Illusion"],"Name":"Blend In","Requirements":null,"Trigger":null,"Type":"None","Usage":"Encounter","UsageDetails":null},{"Action":"Minor","Attacks":[{"AttackBonuses":{},"Effect":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":"The Dark Lantern designates the nearest enemy it can see as its quarry. Once per round, when the Dark Lantern hits its quarry with an attack, the attack deals 1d6 extra damage. The Dark Lantern can designate only one enemy as its quarry at a time.","FailedSavingThrows":[],"IsEmpty":false,"Name":"Effect","Sustains":[]},"Hit":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Hit","Sustains":[]},"Miss":{"Action":null,"AfterEffects":[],"Attacks":[],"Damage":"","Description":null,"FailedSavingThrows":[],"IsEmpty":true,"Name":"Miss","Sustains":[]},"Name":"Effect","Range":"","Targets":null}],"Flavor":null,"IsBasic":false,"Keywords":[],"Name":"Hunter\'s Quarry","Requirements":null,"Trigger":null,"Type":"None","Usage":"At-Will","UsageDetails":"1/round"}],"Regeneration":{"Details":null,"Value":0},"Resistances":[],"Role":"Lurker","SavingThrows":2,"Senses":[],"SourceBook":"Eberron Campaign Setting","SourceBooks":null,"Tactics":"","Traits":[],"Type":"Humanoid","Weaknesses":[],"AbilityScores":{"Constitution":14,"Strength":18,"Dexterity":20,"Intelligence":15,"Wisdom":16,"Charisma":13},"ActionPoints":1,"Alignment":"Unaligned","Defenses":{"AC":24,"Fortitude":22,"Reflex":23,"Will":21},"Experience":700,"Handle":"King\'s Dark Lantern (Lu8E)","HitPoints":136,"Initiative":13,"Speed":6,"Languages":["Common"],"Level":8,"Name":"King\'s Dark Lantern","Race":null,"Skills":{"Perception":12,"Athletics":13,"Bluff":10,"Diplomacy":10,"Intimidate":10,"Stealth":14,"Streetwise":10,"Thievery":14},"Size":"Medium"}';

function ViewModel() {
    var self = this;

    this.Bound = false;

    this.Monster = ko.observable();

    this.Alignment = function () {
        var regex = /(?!^)(?=[A-Z])/;
        return self.Monster().Alignment.replace(regex, " ");
    };
    this.Bloodied = function () {
        return (self.Monster().HitPoints / 2).toFixed(0);
    };
    this.IterationString = function (num) {
        var num = _.isNumber(num) && num || _.isString(num) && parseInt(num, 10) || 0,
            vals = ['Zeroth', 'First', 'Second', 'Third', 'Fourth', 'Fifth', 'Sixth', 'Seventh', 'Eighth', 'Nineth'];

        return vals[num];
    };
    this.LevelString = function () {
        var groupRole = self.Monster().GroupRole,
            role = self.Monster().Role
            parts = [];

        parts.push('Level');
        parts.push(self.Monster().Level);
        if (groupRole !== 'Standard') {
            parts.push(groupRole);
        }
        if (role !== 'No Role') {
            parts.push(role);
        }
        if (self.Monster().IsLeader) {
            parts.push('(Leader)');
        }
        return parts.join(' ');
    };
    this.Repeat = function (str, num) {
        // anything less than 2 is an empty string
        var list = new Array(num + 1);
        return list.join(str);
    };
    this.Skills = function () {
        return _.omit(self.Monster().Skills, 'Perception');
    };
    this.TraitsString = function () {
        var size = self.Monster().Size,
            origin = self.Monster().Origin,
            type = self.Monster().Type,
            keywordList = self.Monster().Keywords,
            keywords = _.size(keywordList) && '(' + keywordList.join(', ') + ')' || '',
            parts = [];

        if (size) parts.push(size);
        if (origin) parts.push(origin);
        if (type) parts.push(type);
        if (keywords) parts.push(keywords);

        return parts.join(' ');
    };
}

// transform the ViewModel so that we can map our data to
// it each time renderStatBlock is called
window.vm = new ViewModel();
ko.bindingProvider.instance = new StringInterpolatingBindingProvider();

// externally invoked method to render a new StatBlock
function renderStatBlock(json) {
    try {
        var data = ko.utils.parseJson(json);
        window.vm.Monster(data);
        if (!vm.Bound) {
            vm.Bound = true;
            ko.applyBindings(window.vm);
        }
    }
    catch (e) {
        alert(e.toString());
    }
}

//$(document).ready(function () {
//   renderStatBlock(debugJson);
//});
